<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <!-- Google Tag Manager -->
  <script>(function (w, d, s, l, i) {
      w[l] = w[l] || []; w[l].push({
        'gtm.start':
          new Date().getTime(), event: 'gtm.js'
      }); var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
          'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-WX5VQK2V');</script>
  <!-- End Google Tag Manager -->
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="./logo.svg" />
  <link rel="manifest" href="/kiddolens-for-youtube/manifest.json" />
  <!-- iOS PWA -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="KiddoLens" />
  <link rel="apple-touch-icon" href="./logo.svg" />
  <!-- Theme color for browser chrome -->
  <meta name="theme-color" content="#355DCE" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>KiddoLens | ËÆìÂ≠©Â≠êÂè™Áúã‰Ω†ÈÅ∏Â•ΩÁöÑ YouTube È†ªÈÅì</title>
  <!-- Fonts: Quicksand for UI, Nunito for Headers -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@700;800&family=Quicksand:wght@500;700&display=swap"
    rel="stylesheet">
  <style>
    /* Preliminary Critical CSS to prevent FOUC */
    body {
      margin: 0;
      font-family: 'Quicksand', sans-serif;
      background-color: #f4f7ff;
      color: #1a2340;
    }
  </style>
  <link rel="stylesheet" href="./src/style.css">
</head>

<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WX5VQK2V" height="0" width="0"
      style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->
  <div id="app">
    <!-- Header -->
    <header class="app-header glass">
      <div class="logo-container">
        <img src="./logo.svg" alt="KiddoLens Logo" class="logo-img" />
        <h1 class="logo-text">KiddoLens</h1>
      </div>

      <div id="profile-selector" class="profile-selector hidden">
        <span class="profile-avatar">üë§</span>
        <span id="header-profile-name" class="current-profile-name">Loading...</span>
        <ul id="profile-dropdown" class="profile-dropdown hidden">
          <!-- Profiles Injected Here -->
        </ul>
      </div>

      <div class="header-controls">
        <button id="refresh-btn" class="icon-btn" title="Refresh Videos">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M23 4v6h-6"></path>
            <path d="M1 20v-6h6"></path>
            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
          </svg>
        </button>
        <button id="history-btn" class="icon-btn" title="Watch History">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
        </button>
        <button id="settings-btn" class="icon-btn" title="Parent Settings">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="3"></circle>
            <path
              d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
            </path>
          </svg>
        </button>
      </div>
    </header>

    <nav id="channel-nav" class="channel-nav">
      <!-- Channel Pills injected here -->
    </nav>
    <div class="channel-toolbar">
      <div class="channel-info">
        <div id="active-channel-display" class="channel-title-display">All Videos</div>
        <span id="video-count" class="video-count">0 videos</span>
        <span id="watch-time-badge" class="watch-time-badge"></span>
      </div>

      <div class="sort-controls">
        <button class="sort-btn active" data-sort="shuffle" title="Shuffle Videos">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            class="sort-icon" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="16 3 21 3 21 8"></polyline>
            <line x1="4" y1="20" x2="21" y2="3"></line>
            <polyline points="21 16 21 21 16 21"></polyline>
            <line x1="15" y1="15" x2="21" y2="21"></line>
            <line x1="4" y1="4" x2="9" y2="9"></line>
          </svg>
        </button>
        <button class="sort-btn" data-sort="newest" title="Newest First">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            class="sort-icon" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
        </button>
      </div>
    </div>

    <!-- Main Content Area -->
    <main class="video-grid" id="video-container">
      <!-- Video cards will be injected here via JS -->
      <div class="loading-state">
        <div class="spinner"></div>
        <p>Loading fun videos...</p>
      </div>
    </main>

    <!-- Video Player Modal -->
    <div id="player-modal" class="modal-overlay hidden">
      <div class="player-modal-content glass-dark">
        <button id="close-player" class="player-close-btn" aria-label="Close">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
        <div class="video-wrapper">
          <div id="youtube-player"></div>
        </div>
        <div class="video-info">
          <p id="video-channel">Channel Name</p>
          <h2 id="video-title">Video Title</h2>
        </div>
      </div>
    </div>

    <!-- Settings Modal (Parent Gate) -->
    <div id="settings-modal" class="modal-overlay hidden">
      <div class="modal-content glass">
        <button id="close-settings" class="close-btn-corner" aria-label="Close">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
        <div class="modal-header">
          <h2 id="settings-title">
            <svg class="settings-gear-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
              viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
              stroke-linejoin="round">
              <circle cx="12" cy="12" r="3"></circle>
              <path
                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
              </path>
            </svg>
            <span id="settings-title-text">Parent Settings</span>
          </h2>
        </div>

        <div class="settings-body">
          <section class="settings-section">
            <h3 id="sync-title">Cloud Sync</h3>
            <p class="small-text">Back up your settings safely.</p>

            <div id="sync-user-info" class="user-info-display hidden"
              style="display: none; align-items: center; gap: 10px; margin-bottom: 15px; padding: 10px; background: #f5f5f5; border-radius: 8px;">
              <img id="sync-avatar" src="" alt="Avatar" style="width: 32px; height: 32px; border-radius: 50%;" />
              <div style="display: flex; flex-direction: column;">
                <span id="sync-name" style="font-weight: 600; font-size: 0.95rem;"></span>
                <span id="sync-email" style="font-size: 0.8rem; color: #666;"></span>
              </div>
            </div>

            <button id="sync-login-btn" class="secondary-btn" style="display:none; margin-top: 10px; width: 100%;">
              Login to Sync
            </button>
            <button id="sync-logout-btn" class="secondary-btn error-btn"
              style="display:none; margin-top: 10px; width: 100%;">
              Logout
            </button>
            <div id="sync-last-time"></div>
          </section>

          <section class="settings-section">
            <h3>Who is watching?</h3>
            <div id="profile-list-container" class="profile-list">
              <!-- Dynamic profiles -->
            </div>

            <div class="add-profile-form" style="margin-top: 1rem; padding-top: 1rem; border-top: 1px dashed #ddd;">
              <input type="text" id="new-profile-name" placeholder="Name of new child..." />
              <button id="add-profile-btn" class="secondary-btn" title="Add Child"
                style="font-size: 1.2rem; line-height: 1; padding: 0 1rem;">+</button>
            </div>
          </section>

          <section class="settings-section">
            <h3>Connection Mode üì∂</h3>

            <!-- Mode Selector Switch -->
            <div class="mode-selector">
              <div id="mode-lite" class="mode-option active">
                <span class="mode-icon">üéà</span> Lite Mode
              </div>
              <div id="mode-pro" class="mode-option">
                <span class="mode-icon">üöÄ</span> Pro Mode
              </div>
              <div class="mode-highlight"></div>
            </div>

            <!-- Dynamic Description Box -->
            <div id="mode-desc-box" class="mode-description lite">
              <span class="info-icon">‚ÑπÔ∏è</span>
              <div>
                <strong id="mode-title-text" style="display:block; margin-bottom:4px; color:#333;">Free &
                  Simple</strong>
                <span id="mode-desc-text">Shows latest 15 videos. No setup required. Perfect for casual viewing.</span>
              </div>
            </div>

            <!-- Pro settings (Hidden by default) -->
            <div id="api-section" class="api-input-container">
              <label style="display:block; margin: 0 0 8px 0; font-weight: 600; font-size: 0.9rem; color: #343a40;">
                YouTube API Key
              </label>
              <div class="input-group">
                <input type="password" id="api-key-input" placeholder="Paste your API Key here..." autocomplete="off" />
                <button id="toggle-api-visibility" class="toggle-visibility-btn" title="Show/Hide">üëÅÔ∏è</button>
              </div>
              <a href="https://console.cloud.google.com/apis/credentials" target="_blank" class="text-link"
                id="get-free-key-link">
                Get a free Key from Google ‚Üó
              </a>
              <button type="button" id="toggle-api-help" class="help-toggle-btn">How to get Key? ‚ùì</button>

              <div id="api-help-content" class="api-help-content hidden">
                <strong id="api-help-title">Steps to get API Key:</strong>
                <ol>
                  <li id="api-help-step1">Go to <a href="https://console.cloud.google.com/" target="_blank">Google Cloud
                      Console</a>.</li>
                  <li id="api-help-step2">Create a <strong>New Project</strong>.</li>
                  <li id="api-help-step3">Search for <strong>"YouTube Data API v3"</strong> and enable it.</li>
                  <li id="api-help-step4">Go to <strong>Credentials</strong> ‚Üí <strong>Create Credentials</strong> ‚Üí
                    <strong>API
                      Key</strong>.
                  </li>
                  <li id="api-help-step5">Copy the key and paste it here!</li>
                </ol>
                <a href="https://developers.google.com/youtube/v3/getting-started" target="_blank"
                  id="full-tutorial-link" style="font-size:0.8rem; display:block; margin-top:5px;">Full Tutorial ‚Üó</a>
              </div>

              <p class="small-text"
                style="color: #d63031; background: #fff5f5; padding: 8px; border-radius: 6px; margin-top: 10px;">
                üîí <strong id="security-note-title">Security Note:</strong> <span id="security-note-text">Your API Key
                  is stored in your private cloud account and synced across your devices. Only you can access it. Tip:
                  in Google Cloud Console, restrict the key to evelynytliu.github.io for extra safety.</span>
              </p>
            </div>


          </section>

          <section class="settings-section">
            <h3>Content Preferences</h3>
            <label style="display: flex; align-items: start; gap: 10px; cursor: pointer;">
              <input type="checkbox" id="filter-shorts-checkbox" checked
                style="width: 20px; height: 20px; margin-top:2px;">
              <div>
                <span style="font-weight: 600; font-size: 1rem;">Filter YouTube Shorts</span>
                <p class="small-text" style="margin-top: 4px; color: #666; font-weight: normal;">
                  <strong>Lite Mode:</strong> Hides videos with '#shorts' in the title.<br>
                  <strong>Pro Mode:</strong> Hides videos under 90 seconds using real duration data.
                </p>
              </div>
            </label>
          </section>

          <!-- Danger Zone -->
          <section class="settings-section" style="margin-top: 20px; border-top: 1px solid #eee; padding-top: 20px;">
            <h3 style="color: #c53030;">Danger Zone ‚ö†Ô∏è</h3>
            <button id="reset-app-btn" class="secondary-btn error-btn" style="width: 100%;">
              Reset All Data & Start Over
            </button>
            <p class="small-text" style="color: #c53030; opacity: 0.8;">This will delete all profiles and settings from
              this device. Cloud backup remains safe.</p>
          </section>
        </div>

        <!-- Sticky Save Footer -->
        <div class="settings-sticky-footer">
          <div id="api-status" class="status-toast"></div>
          <button id="save-api-key" class="primary-btn settings-save-btn">
            üíæ Save Settings
          </button>
        </div>
      </div>
    </div>

    <!-- Watch History Modal -->
    <div id="history-modal" class="modal-overlay hidden">
      <div class="modal-content glass history-modal-content">
        <button id="close-history" class="close-btn-corner" aria-label="Close">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
        <div class="modal-header">
          <h2>
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
              style="vertical-align:middle; margin-right:8px;">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            <span id="history-title-text">Watch History</span>
          </h2>
          <button id="clear-history-btn" class="secondary-btn history-clear-btn">Clear History</button>
        </div>
        <div id="history-list" class="history-list"></div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="app-footer">
      <div class="footer-inner">
        <div class="footer-top">
          <div class="footer-brand">
            <a href="https://evelynytliu.github.io/" target="_blank" rel="noopener noreferrer"
              class="footer-name">Evelyn YT Liu</a>
            <span class="footer-tagline">Designer &amp; Developer ¬∑ Taipei</span>
          </div>
          <nav class="footer-socials" aria-label="Social links">
            <a href="https://github.com/evelynytliu" target="_blank" rel="noopener noreferrer" title="GitHub">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path
                  d="M12 0C5.37 0 0 5.37 0 12c0 5.3 3.44 9.8 8.21 11.39.6.11.82-.26.82-.58v-2.03c-3.34.73-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.09-.75.08-.73.08-.73 1.21.08 1.84 1.24 1.84 1.24 1.07 1.84 2.81 1.3 3.5 1 .11-.78.42-1.3.76-1.6-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.13-.3-.54-1.52.12-3.18 0 0 1.01-.32 3.3 1.23A11.5 11.5 0 0 1 12 5.8c1.02 0 2.04.14 3 .4 2.29-1.55 3.3-1.23 3.3-1.23.66 1.66.25 2.88.12 3.18.77.84 1.24 1.91 1.24 3.22 0 4.61-2.81 5.63-5.48 5.92.43.37.81 1.1.81 2.22v3.29c0 .32.21.7.82.58C20.56 21.8 24 17.3 24 12 24 5.37 18.63 0 12 0z" />
              </svg>
              GitHub
            </a>
            <a href="https://www.instagram.com/eviesmuffy/" target="_blank" rel="noopener noreferrer" title="Instagram">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path
                  d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 1 0 0 12.324 6.162 6.162 0 0 0 0-12.324zM12 16a4 4 0 1 1 0-8 4 4 0 0 1 0 8zm6.406-11.845a1.44 1.44 0 1 0 0 2.881 1.44 1.44 0 0 0 0-2.881z" />
              </svg>
              Instagram
            </a>
            <a href="https://www.linkedin.com/in/evelyn-liu-98871711/" target="_blank" rel="noopener noreferrer"
              title="LinkedIn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path
                  d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" />
              </svg>
              LinkedIn
            </a>
            <a href="mailto:evelyn.evagor@gmail.com" title="Email">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                aria-hidden="true">
                <rect x="2" y="4" width="20" height="16" rx="2" />
                <path d="m2 7 10 7 10-7" />
              </svg>
              Email
            </a>
          </nav>
        </div>
        <div class="footer-bottom">
          <span><span id="footer-text">Created by </span><a href="https://evelynytliu.github.io/" target="_blank"
              rel="noopener noreferrer">Evelyn YT Liu</a></span>
          <span class="footer-copy-right">¬© 2026 ¬∑ All rights reserved</span>
        </div>
      </div>
    </footer>
  </div>
  <script type="module" src="./src/main.js"></script>
  <script src="https://www.youtube.com/iframe_api"></script>
</body>

</html>