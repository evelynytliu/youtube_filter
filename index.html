<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SafeTube Kids | Ad-Free Viewing</title>
  <!-- Fonts: Quicksand for UI, Nunito for Headers -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@700;800&family=Quicksand:wght@500;700&display=swap"
    rel="stylesheet">
  <style>
    /* Preliminary Critical CSS to prevent FOUC */
    body {
      margin: 0;
      font-family: 'Quicksand', sans-serif;
      background-color: #fcefee;
      /* Soft pastel pink/white */
      color: #333;
    }
  </style>
  <link rel="stylesheet" href="./src/style.css">
</head>

<body>
  <div id="app">
    <!-- Header -->
    <header class="app-header glass">
      <div class="logo-container">
        <span class="logo-icon">ğŸˆ</span>
        <h1 class="logo-text">SafeTube</h1>
      </div>

      <div id="profile-selector" class="profile-selector hidden">
        <span class="profile-avatar">ğŸ‘¤</span>
        <span id="header-profile-name" class="current-profile-name">Loading...</span>
        <ul id="profile-dropdown" class="profile-dropdown hidden">
          <!-- Profiles Injected Here -->
        </ul>
      </div>

      <div class="header-controls">
        <button id="refresh-btn" class="icon-btn" title="Refresh Videos">ğŸ”„</button>
        <button id="settings-btn" class="icon-btn" title="Parent Settings">âš™ï¸</button>
      </div>
    </header>

    <nav id="channel-nav" class="channel-nav">
      <!-- Channel Pills injected here -->
    </nav>

    <!-- Toolbar: Sort & Count -->
    <div class="toolbar">
      <span id="video-count" class="video-count">0 videos</span>
      <div class="sort-controls">
        <button class="sort-btn active" data-sort="newest" title="Newest First">
          <span class="sort-icon">ğŸ“…</span>
          <span class="sort-label">Newest</span>
        </button>
        <button class="sort-btn" data-sort="oldest" title="Oldest First">
          <span class="sort-icon">â³</span>
          <span class="sort-label">Oldest</span>
        </button>
        <button class="sort-btn" data-sort="shuffle" title="Shuffle Videos">
          <span class="sort-icon">ğŸ”€</span>
          <span class="sort-label">Shuffle</span>
        </button>
      </div>
    </div>

    <!-- Main Content Area -->
    <main class="video-grid" id="video-container">
      <!-- Video cards will be injected here via JS -->
      <div class="loading-state">
        <div class="spinner"></div>
        <p>Loading fun videos...</p>
      </div>
    </main>

    <!-- Video Player Modal -->
    <div id="player-modal" class="modal-overlay hidden">
      <div class="modal-content glass-dark">
        <button id="close-player" class="close-btn">âŒ Close</button>
        <div class="video-wrapper">
          <div id="youtube-player"></div>
          <!-- Iframe will appear here -->
        </div>
        <div class="video-info">
          <h2 id="video-title">Video Title</h2>
          <p id="video-channel">Channel Name</p>
        </div>
      </div>
    </div>

    <!-- Settings Modal (Parent Gate) -->
    <div id="settings-modal" class="modal-overlay hidden">
      <div class="modal-content glass">
        <button id="close-settings" class="close-btn-corner">âœ–</button>
        <h2>Parent Settings ğŸ”’</h2>

        <section class="settings-section">
          <h3>Who is watching?</h3>
          <div id="profile-list-container" class="profile-list">
            <!-- Dynamic profiles -->
          </div>

          <div class="add-profile-form" style="margin-top: 1rem; padding-top: 1rem; border-top: 1px dashed #ddd;">
            <input type="text" id="new-profile-name" placeholder="Name of new child..." />
            <button id="add-profile-btn" class="secondary-btn" title="Add Child"
              style="font-size: 1.2rem; line-height: 1; padding: 0 1rem;">+</button>
          </div>
        </section>

        <section class="settings-section">
          <h3>Google Sync</h3>
          <p class="small-text">Sync your channels across devices using Google Drive.</p>
          <!-- Client ID is now embedded, hiding input -->
          <div style="display:none;">
            <input type="text" id="client-id-input" placeholder="Google OAuth Client ID" />
            <button id="save-client-id" class="secondary-btn">Save Client ID</button>
          </div>

          <div id="google-user-info" class="user-info-display hidden"
            style="display: none; align-items: center; gap: 10px; margin-bottom: 15px; padding: 10px; background: #f5f5f5; border-radius: 8px;">
            <img id="google-avatar" src="" alt="Avatar" style="width: 32px; height: 32px; border-radius: 50%;" />
            <div style="display: flex; flex-direction: column;">
              <span id="google-name" style="font-weight: 600; font-size: 0.95rem;"></span>
              <span id="google-email" style="font-size: 0.8rem; color: #666;"></span>
            </div>
          </div>

          <button id="google-login-btn" class="primary-btn" style="display:none; margin-top: 10px; width: 100%;">
            Login with Google to Sync
          </button>
        </section>

        <section class="settings-section">
          <h3>YouTube API Key</h3>
          <p class="small-text">Required to fetch videos. Your key is stored locally in your browser.</p>
          <div class="api-input-wrapper" style="display: flex; gap: 8px; margin-bottom: 10px;">
            <input type="password" id="api-key-input" placeholder="Paste your API Key here"
              style="flex: 1; padding: 10px; border-radius: 8px; border: 1px solid #ddd;" />
            <button id="toggle-api-visibility" class="secondary-btn" style="padding: 0 12px; font-size: 1.2rem;"
              title="Show/Hide">ğŸ‘ï¸</button>
          </div>
          <button id="save-api-key" class="primary-btn">Save Key</button>
          <p id="api-status" class="status-msg"></p>
        </section>

        <section class="settings-section"
          style="border-top: 1px solid rgba(0,0,0,0.1); padding-top: 1rem; margin-top: 1rem;">
          <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
            <input type="checkbox" id="share-stats-checkbox" style="width: 20px; height: 20px;">
            <span style="font-weight: 600; font-size: 1rem;">Participate in Ranking (Anonymous)</span>
          </label>
          <p class="small-text" style="margin-top: 5px; color: #666;">
            Help the community discover safe channels! We only share channel names (no personal data).
          </p>
        </section>

        <section class="settings-section">
          <h3>Manage Channels</h3>
          <div class="add-channel-form">
            <div class="search-wrapper">
              <input type="text" id="channel-search-input" placeholder="Search Channel Name (e.g., Peppa Pig)..."
                autocomplete="off" />
              <ul id="search-results-dropdown" class="search-dropdown hidden"></ul>
            </div>
            <!-- Optional: Keep manual add if needed, but search is primary now -->
          </div>
          <ul id="channel-list" class="channel-list">
            <!-- List of added channels -->
          </ul>
          <p class="small-text">Tip: Find Channel ID in the URL of a channel's 'About' page.</p>
        </section>
      </div>
    </div>

    <!-- Parent Gate Challenge Modal -->
    <div id="gate-modal" class="modal-overlay hidden">
      <div class="modal-content glass small-modal">
        <h3>Parents Only! ğŸ›¡ï¸</h3>
        <p id="gate-question"></p>
        <input type="number" id="gate-answer" placeholder="Answer" />
        <button id="gate-submit" class="primary-btn">Unlock</button>
      </div>
    </div>

  </div>
  <script type="module" src="./src/main.js"></script>
  <!-- Add YouTube Iframe API -->
  <script src="https://www.youtube.com/iframe_api"></script>
  <script src="https://accounts.google.com/gsi/client"></script>
</body>

</html>